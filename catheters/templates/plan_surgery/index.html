{% extends 'base.html' %}

{% block content %}

  <script type="text/javascript">
    var updateSugg = function() {
      var term = document.getElementById('srch-term').value;
      //console.log(term);
      if (term === null || term === "") {
        $("#results").html("");
        return;
      }
      $.getJSON('/plan_surgery/dsearch?query='+escape(term), function(json) {
        console.log(json['results']['name']);
        console.log(json['results']['name'][0][1]);
        device = json['results']['name'][0][0] + ': ' + json['results']['name'][0][1];
        if (json.length == 0) {
          $("results").html("");
          return;
        }

        var htmlOut = "<li>"+(json['results']['name'].length)+" result(s)"+"</li>";
        htmlOut += "<li><a href='/device/"+json['results']['name'][0][5]+"'>"+device+"</a></li>";
        htmlOut = "<ul class='sub-menu'>"+htmlOut+"</ul>";
        $("#results").html(htmlOut);
      });
    }
  </script>

  <style type="text/css">
    #c {
      width: 400px;
      height: 300px;
      border: 5px solid black;
  }
  .center {
    text-align: center;
  }
    ul {
      list-style-type: none;
      padding-left:0;
    }
    ul.comments {
      padding-left:10px;
    }
    textarea {
      font-size: 20px;
      line-height: 24px;
      padding: 5px 11px;
    }
    .search {
        position: relative;
        margin: 10px 0px 0px 0px;
        width: 200px;
    }
    .search input {
        height: 26px;
        width: 100%;
        padding: 1px 10px 0px 25px;
        background: white url("http://cssdeck.com/uploads/media/items/5/5JuDgOa.png") 8px 6px no-repeat;
        border-width: 1px;
        border-style: solid;
        border-color: #a8acbc #babdcc #c0c3d2;
        border-radius: 13px;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        -ms-box-sizing: border-box;
        -o-box-sizing: border-box;
        box-sizing: border-box;
        -webkit-box-shadow: inset 0 1px #e5e7ed, 0 1px 0 #fcfcfc;
        -moz-box-shadow: inset 0 1px #e5e7ed, 0 1px 0 #fcfcfc;
        -ms-box-shadow: inset 0 1px #e5e7ed, 0 1px 0 #fcfcfc;
        -o-box-shadow: inset 0 1px #e5e7ed, 0 1px 0 #fcfcfc;
        box-shadow: inset 0 1px #e5e7ed, 0 1px 0 #fcfcfc;
    }

    .search input:focus {
        outline: none;
        border-color: #66b1ee;
        -webkit-box-shadow: 0 0 2px rgba(85, 168, 236, 0.9);
        -moz-box-shadow: 0 0 2px rgba(85, 168, 236, 0.9);
        -ms-box-shadow: 0 0 2px rgba(85, 168, 236, 0.9);
        -o-box-shadow: 0 0 2px rgba(85, 168, 236, 0.9);
        box-shadow: 0 0 2px rgba(85, 168, 236, 0.9);
    }

    .search input:focus + .results { display: block }


    .sub-menu {
        width:100%;
        padding:5px 0px;
        position:absolute;
        top:100%;
        left:0px;
        z-index:-1;
        background:#f2f2f2;
    }

    .sub-menu li {
        display:block;
        font-size:16px;
    }

    .sub-menu li a {
        padding:10px 30px;
        display:block;
    }
  </style>

  <body>

  <style type="text/css">
    #center_div {
      position:fixed;
      top: 50%;
      left: 50%;
      width:100em;
      height:18em;
      margin-top: -15em; /*set to a negative number 1/2 of your height*/
      margin-left: -23em; /*set to a negative number 1/2 of your width*/
    }
  </style>

  <div class = "container">
    <div class="row">
      <div class="col-lg-6">
        <div class="input-group">
          <h1> Plan Surgery </h1>
          <h4> Welcome to the Plan Surgery page! Here, you can search for devices and see a visualization of compatible devices, and you will also be able to assemble a list of the tools you plan to use. </h4>
          <h5> To get started, search for any device and we will try to find it in our records. If we can't find it, you can add more devices <a href="/admin"> here! </a> </h5>
          <form action="/plan_surgery/search" method="get">
            <input type="text" id="srch-term" name="query" class="form-control" placeholder="Search for..." onKeyUp="updateSugg()"/>
            <div id="results">
            </div>
            <input type="submit" class="btn btn-primary" value="Search">
          </form>
        </div>
      </div>
    </div>

    {% load staticfiles %}
    <script src="{% static "scripts/script.js" %}"/>
    {% load staticfiles %}
    <script src="{% static "scripts/three.min.js" %}"/>
    {% load staticfiles %}
    <script src="{% static "scripts/TrackballControls.js" %}"/>

    <script>
      var container, stats;
      var camera, controls, scene, renderer;
      var objects = [], plane;
      var raycaster = new THREE.Raycaster();
      var mouse = new THREE.Vector2(),
      offset = new THREE.Vector3(),
      INTERSECTED, SELECTED;
      init();
      animate();
      function init() {
        container = document.createElement( 'div' );
        document.body.appendChild( container );
        camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 10000 );
        camera.position.z = 1000;
        controls = new THREE.TrackballControls( camera );
        controls.rotateSpeed = 1.0;
        controls.zoomSpeed = 1.2;
        controls.panSpeed = 0.8;
        controls.noZoom = false;
        controls.noPan = false;
        controls.staticMoving = true;
        controls.dynamicDampingFactor = 0.3;
        scene = new THREE.Scene();
        scene.add( new THREE.AmbientLight( 0x505050 ) );
        var light = new THREE.SpotLight( 0xffffff, 1.5 );
        light.position.set( 0, 500, 2000 );
        light.castShadow = true;
        light.shadowCameraNear = 200;
        light.shadowCameraFar = camera.far;
        light.shadowCameraFov = 50;
        light.shadowBias = -0.00022;
        light.shadowMapWidth = 2048;
        light.shadowMapHeight = 2048;
        scene.add( light );
        var geometry = new THREE.BoxGeometry( 40, 40, 40 );
        for ( var i = 0; i < 200; i ++ ) {
          var object = new THREE.Mesh( geometry, new THREE.MeshLambertMaterial( { color: Math.random() * 0xffffff } ) );
          object.position.x = Math.random() * 1000 - 500;
          object.position.y = Math.random() * 600 - 300;
          object.position.z = Math.random() * 800 - 400;
          object.rotation.x = Math.random() * 2 * Math.PI;
          object.rotation.y = Math.random() * 2 * Math.PI;
          object.rotation.z = Math.random() * 2 * Math.PI;
          object.scale.x = Math.random() * 2 + 1;
          object.scale.y = Math.random() * 2 + 1;
          object.scale.z = Math.random() * 2 + 1;
          object.castShadow = true;
          object.receiveShadow = true;
          scene.add( object );
          objects.push( object );
        }
        plane = new THREE.Mesh(
          new THREE.PlaneBufferGeometry( 2000, 2000, 8, 8 ),
          new THREE.MeshBasicMaterial( { visible: false } )
        );
        scene.add( plane );
        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setClearColor( 0xf0f0f0 );
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        renderer.sortObjects = false;
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFShadowMap;
        container.appendChild( renderer.domElement );
        var info = document.createElement( 'div' );
        info.style.position = 'absolute';
        info.style.top = '10px';
        info.style.width = '100%';
        info.style.textAlign = 'center';
        info.innerHTML = '<a href="http://threejs.org" target="_blank">three.js</a> webgl - draggable cubes';
        container.appendChild( info );
        stats = new Stats();
        stats.domElement.style.position = 'absolute';
        stats.domElement.style.top = '0px';
        container.appendChild( stats.domElement );
        renderer.domElement.addEventListener( 'mousemove', onDocumentMouseMove, false );
        renderer.domElement.addEventListener( 'mousedown', onDocumentMouseDown, false );
        renderer.domElement.addEventListener( 'mouseup', onDocumentMouseUp, false );
        //
        window.addEventListener( 'resize', onWindowResize, false );
      }
      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( window.innerWidth, window.innerHeight );
      }
      function onDocumentMouseMove( event ) {
        event.preventDefault();
        mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
        mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
        //
        raycaster.setFromCamera( mouse, camera );
        if ( SELECTED ) {
          var intersects = raycaster.intersectObject( plane );
          if ( intersects.length > 0 ) {
            SELECTED.position.copy( intersects[ 0 ].point.sub( offset ) );
          }
          return;
        }
        var intersects = raycaster.intersectObjects( objects );
        if ( intersects.length > 0 ) {
          if ( INTERSECTED != intersects[ 0 ].object ) {
            if ( INTERSECTED ) INTERSECTED.material.color.setHex( INTERSECTED.currentHex );
            INTERSECTED = intersects[ 0 ].object;
            INTERSECTED.currentHex = INTERSECTED.material.color.getHex();
            plane.position.copy( INTERSECTED.position );
            plane.lookAt( camera.position );
          }
          container.style.cursor = 'pointer';
        } else {
          if ( INTERSECTED ) INTERSECTED.material.color.setHex( INTERSECTED.currentHex );
          INTERSECTED = null;
          container.style.cursor = 'auto';
        }
      }
      function onDocumentMouseDown( event ) {
        event.preventDefault();
        raycaster.setFromCamera( mouse, camera );
        var intersects = raycaster.intersectObjects( objects );
        if ( intersects.length > 0 ) {
          controls.enabled = false;
          SELECTED = intersects[ 0 ].object;
          var intersects = raycaster.intersectObject( plane );
          if ( intersects.length > 0 ) {
            offset.copy( intersects[ 0 ].point ).sub( plane.position );
          }
          container.style.cursor = 'move';
        }
      }
      function onDocumentMouseUp( event ) {
        event.preventDefault();
        controls.enabled = true;
        if ( INTERSECTED ) {
          plane.position.copy( INTERSECTED.position );
          SELECTED = null;
        }
        container.style.cursor = 'auto';
      }
      //
      function animate() {
        requestAnimationFrame( animate );
        render();
        stats.update();
      }
      function render() {
        controls.update();
        renderer.render( scene, camera );
      }
    </script>

    </body>

    
  
{% endblock %}
