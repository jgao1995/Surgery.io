<!DOCTYPE html>
<html>
  <head>
    {% load bootstrap3 %}
    {% bootstrap_css %}
    {% bootstrap_javascript %}
    {# Display django.contrib.messages as Bootstrap alerts #}
    {% bootstrap_messages %}
    {% load staticfiles %}
    <link rel="stylesheet" type="text/css" href="{% static "stylesheets/new_surgery.css" %}">
    <script src = "https://code.jquery.com/jquery-2.1.4.min.js" ></script>
    <script type="text/javascript"> 
      var devices = [];
      var add_device = function(id) {
        console.log("it worked for " + id);
        devices.push(id);
        console.log(devices);
        update_list();
      };
      var remove_device = function(id) {
        console.log("removed device " + id);
        var index = devices.indexOf(id);
        if (index > -1) {
          devices.splice(index, 1);
        }
        console.log(devices);
        $("#device"+id).html("");
        update_list();
      }
      var update_list = function() {
        var htmlOut = "";
        console.log(devices.length);
        console.log(devices);
        for (var i = 0; i < devices.length; i++) {
          device = devices[i];
          $.getJSON('/device/'+device+'/JSON', function(json) {
            htmlOut += "<li><a id='device"+device+"' href='#' onclick='remove_device("+device+");'>"+ json['brand_name'] + " " + json['man'] + " " + json['description'] + " " + json['type'] +"</a></li>";
            $("#active_device_list").html(htmlOut);
          });
        }
        console.log("htmlOut: "+htmlOut);
      }
    </script>
  </head>

  <body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-brand" href="/">
            <p> Catheter App </p>
          </a>
        </div>
        <a class="navbar-brand" href="/plan_surgery">Plan Surgery</a>
        <a class="navbar-brand" href="/all">All Devices</a>
        <a class="navbar-brand" href="/add_device">Add Device</a>
        <a class="navbar-brand" href="/add_device_type">Add Device Type</a>
        {% if request.user.is_authenticated %}
        <a class="navbar-brand navbar-right" href="/logout">Log Out</a>
        {% else %}
        <a class="navbar-brand navbar-right" href="/login">Log In</a>
        {% endif %}
      </div>
    </nav>

    <h1> Plan a surgery </h1>
    <div id='all_devices'>
      <h2> All Available Device </h2>
      <ul class="list-group">
        {% for d in devices %}
          <li class="list-group-item">
          <a id="device" href="#" onclick="add_device({{d.id}});" name="{{ d.id }}"> {{ d.brand_name }} {{ d.manufacturer }} {{ d.description }} {{ d.product_type }}</a>
          </li>
	      {% endfor %}
	    </ul>
    </div>

    <div id='active_devices'>
      <h2> Current Device in Surgery </h2>
      <ul id='active_device_list'>
      </ul>
    </div>
  </body>
</html>
